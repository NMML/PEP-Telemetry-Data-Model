<?xml version = '1.0' encoding = 'UTF-8'?>
<StoredProcedureOraclev10g class="oracle.dbtools.crest.model.design.storage.oracle.v10g.StoredProcedureOraclev10g" name="UPDATELOCATIONS" id="A118428F-010C-2017-605F-A881EA6209C3" directorySegmentName="seg_0">
<sourceConnName>test_peptel</sourceConnName>
<sourceObjSchema>PEPTEL</sourceObjSchema>
<sourceObjName>UPDATELOCATIONS</sourceObjName>
<createdBy>Josh.London@afsc.noaa.gov</createdBy>
<createdTime>2013-03-27 17:10:18 UTC</createdTime>
<ownerDesignName>pep_telemetry</ownerDesignName>
<owner>7FA7C775-8AA2-5E8C-D91A-A81EC4048787</owner>
<source>CREATE OR REPLACE PROCEDURE PEPTEL.UPDATELOCATIONS&lt;br/&gt;authid current_user&lt;br/&gt;IS&lt;br/&gt;  C NUMBER;&lt;br/&gt;BEGIN&lt;br/&gt;  execute immediate &apos;set role ALL&apos;;&lt;br/&gt;  SELECT COUNT(*) INTO C&lt;br/&gt;  FROM USER_SEQUENCES&lt;br/&gt;  WHERE SEQUENCE_NAME = &apos;LOC_SEQ&apos;;&lt;br/&gt;&lt;br/&gt;  IF (C = 0) THEN&lt;br/&gt;    EXECUTE IMMEDIATE &apos;CREATE SEQUENCE LOC_SEQ START WITH 1 INCREMENT BY 1 MINVALUE 0&apos;;&lt;br/&gt;    ELSE&lt;br/&gt;    EXECUTE IMMEDIATE &apos;DROP SEQUENCE LOC_SEQ&apos;; &lt;br/&gt;    EXECUTE IMMEDIATE &apos;CREATE SEQUENCE LOC_SEQ START WITH 1 INCREMENT BY 1 MINVALUE 0&apos;;&lt;br/&gt;  END IF;&lt;br/&gt;  EXECUTE IMMEDIATE &apos;TRUNCATE TABLE PEPTEL.LOCATIONS&apos;;&lt;br/&gt;  commit;&lt;br/&gt;  EXECUTE IMMEDIATE &apos;&lt;br/&gt;  INSERT INTO PEPTEL.LOCATIONS&lt;br/&gt;    SELECT &lt;br/&gt;    NULL AS LOCID,&lt;br/&gt;    GET_GEOM(to_number(EXTLOCATIONS.LONGITUDE),to_number(EXTLOCATIONS.LATITUDE)) COORDS,&lt;br/&gt;    PEPDEPLOYMENTS.DEPLOYID,&lt;br/&gt;    PEPCAPTUREDATA.SPENO,&lt;br/&gt;    PEPCAPTUREDATA.PROJECTID,&lt;br/&gt;    PEPCAPTUREDATA.SPECIES,&lt;br/&gt;    PEPDEPLOYMENTS.DEPLOYDATE,&lt;br/&gt;    PEPTAGINFO.TAGTYPE,&lt;br/&gt;    PEPCAPTUREDATA.AGE,&lt;br/&gt;    PEPCAPTUREDATA.SEX,&lt;br/&gt;    TO_DATE(EXTLOCATIONS.LOCATIONDATE,&apos;&apos;YYYY-MM-DD HH24:MI:SS&apos;&apos;) DATADATETIME,&lt;br/&gt;    TO_CHAR(TO_DATE(EXTLOCATIONS.LOCATIONDATE,&apos;&apos;YYYY-MM-DD HH24:MI:SS&apos;&apos;),&apos;&apos;YYYY-MM-DD HH24&apos;&apos;) DATAHOUR,&lt;br/&gt;    EXTLOCATIONS.QUALITY,&lt;br/&gt;    to_number(EXTLOCATIONS.LATITUDE) LATITUDE,&lt;br/&gt;    to_number(EXTLOCATIONS.LONGITUDE) LONGITUDE,&lt;br/&gt;    to_number(EXTLOCATIONS.ERROR_RADIUS) ERROR_RADIUS,&lt;br/&gt;    to_number(EXTLOCATIONS.ERROR_SEMI_MAJOR_AXIS) ERROR_SEMI_MAJOR_AXIS,&lt;br/&gt;    to_number(EXTLOCATIONS.ERROR_SEMI_MINOR_AXIS) ERROR_SEMI_MINOR_AXIS,&lt;br/&gt;    to_number(EXTLOCATIONS.ERROR_ELLIPSE_ORIENTATION) ERROR_ELLIPSE_ORIENTATION&lt;br/&gt;  FROM EXTLOCATIONS&lt;br/&gt;  LEFT JOIN PEPDEPLOYMENTS&lt;br/&gt;  ON PEPDEPLOYMENTS.DEPLOYID = EXTLOCATIONS.DEPLOYID&lt;br/&gt;  LEFT JOIN PEPCAPTUREDATA&lt;br/&gt;  ON PEPDEPLOYMENTS.SPENO = PEPCAPTUREDATA.SPENO&lt;br/&gt;  LEFT JOIN PEPTAGINFO&lt;br/&gt;  ON PEPDEPLOYMENTS.SERIALNUM = PEPTAGINFO.SERIALNUM&lt;br/&gt;  WHERE EXTLOCATIONS.LATITUDE       IS NOT NULL &lt;br/&gt;  AND EXTLOCATIONS.LOCATIONDATE IS NOT NULL&lt;br/&gt;  AND TO_DATE(EXTLOCATIONS.LOCATIONDATE,&apos;&apos;YYYY-MM-DD HH24:MI:SS&apos;&apos;) &gt; TO_DATE(PEPDEPLOYMENTS.DEPLOYDATE,&apos;&apos;YYYY-MM-DD HH24:MI:SS&apos;&apos;)+12/24&apos;;&lt;br/&gt;  COMMIT;&lt;br/&gt;  EXECUTE IMMEDIATE &apos;&lt;br/&gt;  DELETE FROM PEPTEL.LOCATIONS&lt;br/&gt;  WHERE DEPLOYID IN (SELECT DEPLOYID FROM LOCATIONS_REPRO) AND&lt;br/&gt;  DATADATETIME BETWEEN (SELECT MIN(DATADATETIME)&lt;br/&gt;  FROM LOCATIONS_REPRO) AND (SELECT MAX(DATADATETIME) FROM LOCATIONS_REPRO)&apos;;&lt;br/&gt;  COMMIT;&lt;br/&gt;  EXECUTE IMMEDIATE &apos;&lt;br/&gt;  INSERT INTO PEPTEL.LOCATIONS&lt;br/&gt;  SELECT&lt;br/&gt;  NULL AS LOCID,&lt;br/&gt;  GET_GEOM(LOCATIONS_REPRO.LONGITUDE,LOCATIONS_REPRO.LATITUDE) COORDS,&lt;br/&gt;    LOCATIONS_REPRO.DEPLOYID,&lt;br/&gt;    LOCATIONS_REPRO.SPENO,&lt;br/&gt;    LOCATIONS_REPRO.PROJECTID,&lt;br/&gt;    LOCATIONS_REPRO.SPECIES,&lt;br/&gt;    LOCATIONS_REPRO.DEPLOYDATE,&lt;br/&gt;    LOCATIONS_REPRO.TAGTYPE,&lt;br/&gt;    LOCATIONS_REPRO.AGE,&lt;br/&gt;    LOCATIONS_REPRO.SEX,&lt;br/&gt;    LOCATIONS_REPRO.DATADATETIME,&lt;br/&gt;    LOCATIONS_REPRO.DATAHOUR,&lt;br/&gt;    LOCATIONS_REPRO.LOCATIONQUALITY AS QUALITY,&lt;br/&gt;    LOCATIONS_REPRO.LATITUDE LATITUDE,&lt;br/&gt;    LOCATIONS_REPRO.LONGITUDE LONGITUDE,&lt;br/&gt;    LOCATIONS_REPRO.ERROR_RADIUS ERROR_RADIUS,&lt;br/&gt;    LOCATIONS_REPRO.SEMIMAJOR ERROR_SEMI_MAJOR_AXIS,&lt;br/&gt;    LOCATIONS_REPRO.SEMIMINOR ERROR_SEMI_MINOR_AXIS,&lt;br/&gt;    LOCATIONS_REPRO.ELLIPSE_ORIENT ERROR_ELLIPSE_ORIENTATION&lt;br/&gt;  FROM LOCATIONS_REPRO&lt;br/&gt;  WHERE LOCATIONS_REPRO.LATITUDE IS NOT NULL &lt;br/&gt;  AND LOCATIONS_REPRO.DATADATETIME IS NOT NULL&lt;br/&gt;  AND LOCATIONS_REPRO.DATADATETIME &gt; LOCATIONS_REPRO.DEPLOYDATE+12/24&apos;; &lt;br/&gt;  COMMIT;&lt;br/&gt;  EXECUTE IMMEDIATE &apos;DROP INDEX LOC_IDX&apos;;&lt;br/&gt;  commit;&lt;br/&gt;  EXECUTE IMMEDIATE &apos;&lt;br/&gt;    create index LOC_IDX on &lt;br/&gt;    LOCATIONS(COORDS)&lt;br/&gt;    indextype is mdsys.spatial_index&apos;;&lt;br/&gt;    COMMIT;&lt;br/&gt;    CREATETRACKS();&lt;br/&gt;END;</source>
<body>CREATE OR REPLACE PROCEDURE PEPTEL.UPDATELOCATIONS&lt;br/&gt;authid current_user&lt;br/&gt;IS&lt;br/&gt;  C NUMBER;&lt;br/&gt;BEGIN&lt;br/&gt;  execute immediate &apos;set role ALL&apos;;&lt;br/&gt;  SELECT COUNT(*) INTO C&lt;br/&gt;  FROM USER_SEQUENCES&lt;br/&gt;  WHERE SEQUENCE_NAME = &apos;LOC_SEQ&apos;;&lt;br/&gt;&lt;br/&gt;  IF (C = 0) THEN&lt;br/&gt;    EXECUTE IMMEDIATE &apos;CREATE SEQUENCE LOC_SEQ START WITH 1 INCREMENT BY 1 MINVALUE 0&apos;;&lt;br/&gt;    ELSE&lt;br/&gt;    EXECUTE IMMEDIATE &apos;DROP SEQUENCE LOC_SEQ&apos;; &lt;br/&gt;    EXECUTE IMMEDIATE &apos;CREATE SEQUENCE LOC_SEQ START WITH 1 INCREMENT BY 1 MINVALUE 0&apos;;&lt;br/&gt;  END IF;&lt;br/&gt;  EXECUTE IMMEDIATE &apos;TRUNCATE TABLE PEPTEL.LOCATIONS&apos;;&lt;br/&gt;  commit;&lt;br/&gt;  EXECUTE IMMEDIATE &apos;&lt;br/&gt;  INSERT INTO PEPTEL.LOCATIONS&lt;br/&gt;    SELECT &lt;br/&gt;    NULL AS LOCID,&lt;br/&gt;    GET_GEOM(to_number(EXTLOCATIONS.LONGITUDE),to_number(EXTLOCATIONS.LATITUDE)) COORDS,&lt;br/&gt;    PEPDEPLOYMENTS.DEPLOYID,&lt;br/&gt;    PEPCAPTUREDATA.SPENO,&lt;br/&gt;    PEPCAPTUREDATA.PROJECTID,&lt;br/&gt;    PEPCAPTUREDATA.SPECIES,&lt;br/&gt;    PEPDEPLOYMENTS.DEPLOYDATE,&lt;br/&gt;    PEPTAGINFO.TAGTYPE,&lt;br/&gt;    PEPCAPTUREDATA.AGE,&lt;br/&gt;    PEPCAPTUREDATA.SEX,&lt;br/&gt;    TO_DATE(EXTLOCATIONS.LOCATIONDATE,&apos;&apos;YYYY-MM-DD HH24:MI:SS&apos;&apos;) DATADATETIME,&lt;br/&gt;    TO_CHAR(TO_DATE(EXTLOCATIONS.LOCATIONDATE,&apos;&apos;YYYY-MM-DD HH24:MI:SS&apos;&apos;),&apos;&apos;YYYY-MM-DD HH24&apos;&apos;) DATAHOUR,&lt;br/&gt;    EXTLOCATIONS.QUALITY,&lt;br/&gt;    to_number(EXTLOCATIONS.LATITUDE) LATITUDE,&lt;br/&gt;    to_number(EXTLOCATIONS.LONGITUDE) LONGITUDE,&lt;br/&gt;    to_number(EXTLOCATIONS.ERROR_RADIUS) ERROR_RADIUS,&lt;br/&gt;    to_number(EXTLOCATIONS.ERROR_SEMI_MAJOR_AXIS) ERROR_SEMI_MAJOR_AXIS,&lt;br/&gt;    to_number(EXTLOCATIONS.ERROR_SEMI_MINOR_AXIS) ERROR_SEMI_MINOR_AXIS,&lt;br/&gt;    to_number(EXTLOCATIONS.ERROR_ELLIPSE_ORIENTATION) ERROR_ELLIPSE_ORIENTATION&lt;br/&gt;  FROM EXTLOCATIONS&lt;br/&gt;  LEFT JOIN PEPDEPLOYMENTS&lt;br/&gt;  ON PEPDEPLOYMENTS.DEPLOYID = EXTLOCATIONS.DEPLOYID&lt;br/&gt;  LEFT JOIN PEPCAPTUREDATA&lt;br/&gt;  ON PEPDEPLOYMENTS.SPENO = PEPCAPTUREDATA.SPENO&lt;br/&gt;  LEFT JOIN PEPTAGINFO&lt;br/&gt;  ON PEPDEPLOYMENTS.SERIALNUM = PEPTAGINFO.SERIALNUM&lt;br/&gt;  WHERE EXTLOCATIONS.LATITUDE       IS NOT NULL &lt;br/&gt;  AND EXTLOCATIONS.LOCATIONDATE IS NOT NULL&lt;br/&gt;  AND TO_DATE(EXTLOCATIONS.LOCATIONDATE,&apos;&apos;YYYY-MM-DD HH24:MI:SS&apos;&apos;) &gt; TO_DATE(PEPDEPLOYMENTS.DEPLOYDATE,&apos;&apos;YYYY-MM-DD HH24:MI:SS&apos;&apos;)+12/24&apos;;&lt;br/&gt;  COMMIT;&lt;br/&gt;  EXECUTE IMMEDIATE &apos;&lt;br/&gt;  DELETE FROM PEPTEL.LOCATIONS&lt;br/&gt;  WHERE DEPLOYID IN (SELECT DEPLOYID FROM LOCATIONS_REPRO) AND&lt;br/&gt;  DATADATETIME BETWEEN (SELECT MIN(DATADATETIME)&lt;br/&gt;  FROM LOCATIONS_REPRO) AND (SELECT MAX(DATADATETIME) FROM LOCATIONS_REPRO)&apos;;&lt;br/&gt;  COMMIT;&lt;br/&gt;  EXECUTE IMMEDIATE &apos;&lt;br/&gt;  INSERT INTO PEPTEL.LOCATIONS&lt;br/&gt;  SELECT&lt;br/&gt;  NULL AS LOCID,&lt;br/&gt;  GET_GEOM(LOCATIONS_REPRO.LONGITUDE,LOCATIONS_REPRO.LATITUDE) COORDS,&lt;br/&gt;    LOCATIONS_REPRO.DEPLOYID,&lt;br/&gt;    LOCATIONS_REPRO.SPENO,&lt;br/&gt;    LOCATIONS_REPRO.PROJECTID,&lt;br/&gt;    LOCATIONS_REPRO.SPECIES,&lt;br/&gt;    LOCATIONS_REPRO.DEPLOYDATE,&lt;br/&gt;    LOCATIONS_REPRO.TAGTYPE,&lt;br/&gt;    LOCATIONS_REPRO.AGE,&lt;br/&gt;    LOCATIONS_REPRO.SEX,&lt;br/&gt;    LOCATIONS_REPRO.DATADATETIME,&lt;br/&gt;    LOCATIONS_REPRO.DATAHOUR,&lt;br/&gt;    LOCATIONS_REPRO.LOCATIONQUALITY AS QUALITY,&lt;br/&gt;    LOCATIONS_REPRO.LATITUDE LATITUDE,&lt;br/&gt;    LOCATIONS_REPRO.LONGITUDE LONGITUDE,&lt;br/&gt;    LOCATIONS_REPRO.ERROR_RADIUS ERROR_RADIUS,&lt;br/&gt;    LOCATIONS_REPRO.SEMIMAJOR ERROR_SEMI_MAJOR_AXIS,&lt;br/&gt;    LOCATIONS_REPRO.SEMIMINOR ERROR_SEMI_MINOR_AXIS,&lt;br/&gt;    LOCATIONS_REPRO.ELLIPSE_ORIENT ERROR_ELLIPSE_ORIENTATION&lt;br/&gt;  FROM LOCATIONS_REPRO&lt;br/&gt;  WHERE LOCATIONS_REPRO.LATITUDE IS NOT NULL &lt;br/&gt;  AND LOCATIONS_REPRO.DATADATETIME IS NOT NULL&lt;br/&gt;  AND LOCATIONS_REPRO.DATADATETIME &gt; LOCATIONS_REPRO.DEPLOYDATE+12/24&apos;; &lt;br/&gt;  COMMIT;&lt;br/&gt;  EXECUTE IMMEDIATE &apos;DROP INDEX LOC_IDX&apos;;&lt;br/&gt;  commit;&lt;br/&gt;  EXECUTE IMMEDIATE &apos;&lt;br/&gt;    create index LOC_IDX on &lt;br/&gt;    LOCATIONS(COORDS)&lt;br/&gt;    indextype is mdsys.spatial_index&apos;;&lt;br/&gt;    COMMIT;&lt;br/&gt;    CREATETRACKS();&lt;br/&gt;END;</body>
</StoredProcedureOraclev10g>